(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerpolicy&&(s.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?s.credentials="include":i.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();window.windowConfig=null;window.compactWindow=function(){function e(){window.innerWidth<1225?document.body.setAttribute("compact",""):document.body.removeAttribute("compact")}e(),window.removeEventListener("resize",e),window.addEventListener("resize",e)};window.loadWindowConfig=async function(){window.windowConfig=await window.go.main.App.LoadWindowConfig(),console.debug("Window Config loaded"),console.debug("Window Config:",window.windowConfig);const e=window.windowConfig["color-scheme"]||{},t=Object.entries(e).find(([s,c])=>c===!0);t&&document.body.setAttribute("color-scheme",t[0]);const n=document.getElementById("selectScheme");n&&(n.innerHTML="",Object.keys(e).forEach(s=>{const c=document.createElement("option");c.value=s,c.textContent=s,t&&s===t[0]&&(c.selected=!0),n.appendChild(c)}),n.addEventListener("change",s=>{const c=s.target.value;window.setColorScheme(c)}));const o=window.windowConfig["sidebar-state"]||"",i=document.querySelector(".sidebar");o==="collapsed"?i.setAttribute("collapsed",""):i.removeAttribute("collapsed")};window.setColorScheme=async function(e){!window.windowConfig||(Object.keys(window.windowConfig["color-scheme"]).forEach(t=>window.windowConfig["color-scheme"][t]=!1),window.windowConfig["color-scheme"].hasOwnProperty(e)&&(window.windowConfig["color-scheme"][e]=!0),document.body.setAttribute("color-scheme",e),await window.go.main.App.UpdateWindowConfig(window.windowConfig))};window.loadWindowConfig();let G=!1,x=null;const M=document.getElementById("log"),z=document.getElementById("error"),y=document.getElementById("init"),r=document.getElementById("gitConsole"),f=document.getElementById("toggleConsoleBtn");function a(e){M.textContent=e,console.log(e)}function l(e){z.textContent=e,console.error(e)}function V(...e){const t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(" ");r.value+=t+`
`,r.scrollTop=r.scrollHeight}["log","error","warn","info"].forEach(e=>{const t=console[e];console[e]=(...n)=>{t(...n),V(...n)}});window.runtime.EventsOn("logToGitConsole",e=>{r.value+=e+`
`,r.scrollTop=r.scrollTop});f==null||f.addEventListener("click",()=>{r.style.display==="none"?(r.style.display="block",f.textContent="Hide Console"):(r.style.display="none",f.textContent="Show Console")});async function K(){a("Detecting OS...");const e=await window.go.main.App.GetOS();return await d(800),a(`Operating System detected: ${e}`),await d(200),e||l("Couldnt detect operating system.."),e==="darwin"&&document.body.classList.add("darwin"),e}async function N(){a("Checking if git is installed...");const e=await window.go.main.App.IsGitInstalled();return e||l("Git is not installed. Go get it!"),await d(200),e}async function Z(){a("Searching for configuration...");let e=await window.go.main.App.CheckConfigExists();return e?a("Configuration found."):(a("Configuration missing, creating new one.."),await window.go.main.App.CreateConfig(),a("Configuration created."),e=!0),await d(200),e}async function J(){a("Validating configuration...");const e=await window.go.main.App.ValidateConfig();return e?(x=e,a("Validated.")):l("Configuration invalid.."),await d(200),e}function d(e){return new Promise(t=>setTimeout(t,e))}async function H(){try{const e=await K(),t=await N(),n=await Z();await J()&&t||x?(G=!0,a("Ready."),await d(1200),y.classList.remove("initializing"),g(),y.classList.add("doneinit"),await d(1e3),y.classList.add("initted")):t?(l("Init failure. What a bummer.."),await d(3e3),l("Deleting Config and trying again..."),await d(3e3),await window.go.main.App.DeleteConfig()):l("Git required for gituserChrome...")}catch(e){l("Init failed: "+e.message)}}H();window.compactWindow();const W=document.querySelector(".nav-sidebar"),w=document.querySelector(".sidebar");W&&w&&W.addEventListener("click",()=>{let e="";w.hasAttribute("collapsed")?(w.removeAttribute("collapsed"),e=""):(w.setAttribute("collapsed",""),e="collapsed"),window.windowConfig&&(window.windowConfig["sidebar-state"]=e,window.go.main.App.UpdateWindowConfig(window.windowConfig))});const Q={".nav-setup":document.querySelectorAll(".nav-setup.nav-entry"),".nav-fcss":document.querySelectorAll(".nav-fcss.nav-entry"),".nav-git":document.querySelectorAll(".nav-git.nav-entry"),".nav-settings":document.querySelectorAll(".nav-settings.nav-entry"),".nav-more":document.querySelectorAll(".nav-more.nav-entry")};Object.entries(Q).forEach(([e,t])=>{t.forEach(n=>{n.addEventListener("click",()=>h(e))})});function h(e){if(!e)return;const t=e.startsWith(".")?e.slice(1):e;document.querySelectorAll(".nav-entry[selected]").forEach(n=>{n.removeAttribute("selected")}),document.querySelectorAll(`.nav-entry.${t}`).forEach(n=>{n.setAttribute("selected","")}),document.querySelectorAll(".page[selected]").forEach(n=>{n.removeAttribute("selected")}),document.querySelectorAll(`.page.${t}`).forEach(n=>{n.setAttribute("selected","")})}const F=document.getElementById("git_is"),C=document.getElementById("os_is"),v=document.getElementById("firefox_is"),b=document.getElementById("selected_profile"),p=document.getElementById("selected_theme"),$=document.getElementById("apply_userjs"),j=document.getElementById("allow_restart"),q=document.getElementById("backup_chrome");async function g(){const e=await window.go.main.App.ValidateConfig();if(!e){console.log("Config not found."),console.debug("connectConfig: Config not found.",e);return}if(console.debug("connectConfig: Config found.",e),F&&(F.checked=e.git_is),$&&($.checked=e.apply_userjs),j&&(j.checked=e.allow_restart),q&&(q.checked=e.backup_chrome),C&&(C.innerHTML="",["windows","darwin","linux"].forEach(t=>{const n=document.createElement("option");n.value=t,n.textContent=t.charAt(0).toUpperCase()+t.slice(1),e.os_is===t&&(n.selected=!0),C.appendChild(n)})),v&&(v.innerHTML="",Object.keys(e.firefoxs).forEach(t=>{const n=document.createElement("option");n.value=t,n.textContent=t,e.firefox_is===t&&(n.selected=!0),v.appendChild(n)})),b&&(b.innerHTML="",Object.entries(e.firefox_profiles).forEach(([t,n])=>{const o=document.createElement("option");o.value=t,o.textContent=t,e.selected_profile===t&&(o.selected=!0),b.appendChild(o)})),p){p.innerHTML="";const t=document.createElement("option");t.value="placeholder",t.textContent="-- Select a theme --",t.disabled=!0,t.selected=!e.selected_theme,p.appendChild(t),Object.keys(e.saved_themes).forEach(n=>{const o=document.createElement("option");o.value=n,o.textContent=n,e.selected_theme===n&&(o.selected=!0),p.appendChild(o)})}window.globalConfig=e}async function P(e,t){if(!window.globalConfig){console.debug("updateConfigValue: globalConfig is undefined");return}window.globalConfig[e]=t;try{await window.go.main.App.WriteToConfig(e,t),console.log(`Config updated: ${e} = ${t}`)}catch(n){console.error("updateConfigValue: failed to write to config:",n)}}function X(){const e=document.querySelector(".nav-setup .page-container");if(!e){console.debug("attachConfigListeners: can't attach listeners to nav-setup page");return}e.querySelectorAll("select").forEach(t=>{console.debug("Attaching listener to select:",t.id),t.addEventListener("change",()=>{console.debug("attachConfigListeners: change detected"),P(t.id,t.value)})}),e.querySelectorAll("input").forEach(t=>{console.debug("Attaching listener to input:",t.id),t.addEventListener("change",()=>{let n;t.type==="checkbox"?n=t.checked:n=t.value,console.debug(`attachConfigListeners: input ${t.id} changed to`,n),P(t.id,n)})})}(async function(){try{await g(),X()}catch{}})();let D=!1;document.querySelector(".nav-settings");const R=document.getElementById("saveSettingsBtn"),T={fsFBinary:["Firefox","fsFBinary","fsFBinaryInput"],fsFdBinary:["Firefox Developer Edition","fsFdBinary","fsFdBinaryInput"],fsFnBinary:["Firefox Nightly","fsFnBinary","fsFnBinaryInput"],fsLBinary:["Librewolf","fsLBinary","fsLBinaryInput"],fsZBinary:["Zen Browser","fsZBinary","fsZBinaryInput"],fsFloorpBinary:["Floorp","fsFloorpBinary","fsFloorpBinaryInput"],fsProfile:[null,"fsProfile","fsProfileInput"]};async function Y(){const e=window.globalConfig;if(!e){console.error("Attempt to connect to settings config failed..");return}console.debug("Settings Configuration:",e);for(const[n,[o,i,s]]of Object.entries(T)){const c=document.getElementById(s);!c||(c.value=o&&e.firefoxs[o]||"",console.debug(`Settings cfg ${o}:`,c.value))}const t=document.getElementById("selectTheme");if(t){const n=e.selected_theme;n&&e.saved_themes[n]?(t.value=e.saved_themes[n],t.dataset.theme=n):(t.value="",t.dataset.theme=""),console.debug("Settings cfg theme input value:",t.value)}}const E=document.getElementById("addTheme"),A=document.getElementById("removeTheme");function O(e){if(e=e.trim(),!e)return null;let t,n;!e.startsWith("http://")&&!e.startsWith("https://")&&(e="https://"+e);try{const o=new URL(e);if(n=o.href,!["github.com","gitlab.com","codeberg.org"].includes(o.hostname))return null;const s=o.pathname.split("/").filter(Boolean);if(s.length<2)return null;t=s[1]}catch{return null}return{name:t,url:n}}function U(e,t,n){return Object.entries(e.saved_themes).some(([o,i])=>o===t||i===n)}async function ee(e,t,n,o){e.saved_themes[t]=n,e.selected_theme=t,await window.go.main.App.WriteToConfig(`saved_themes.${t}`,n),await window.go.main.App.WriteToConfig("selected_theme",t),o.value="",o.dataset.theme="",await g(),console.log(`Theme added: ${t} => ${n}`)}async function te(e,t,n){await window.go.main.App.RemoveFromConfig(`saved_themes.${t}`),delete e.saved_themes[t],Object.keys(e.saved_themes).length===0?(e.selected_theme="",n.value="",n.dataset.theme=""):(e.selected_theme=Object.keys(e.saved_themes)[0],await window.go.main.App.WriteToConfig("selected_theme",e.selected_theme),n.value="",n.dataset.theme="");const o=document.getElementById("selectTheme");if(o){o.innerHTML="";const i=document.createElement("option");i.value="placeholder",i.textContent="-- Select a theme --",i.disabled=!0,i.selected=!e.selected_theme,o.appendChild(i),Object.keys(e.saved_themes).forEach(s=>{const c=document.createElement("option");c.value=s,c.textContent=s,e.selected_theme===s&&(c.selected=!0),o.appendChild(c)})}await g(),console.log(`Theme removed: ${t}`)}E==null||E.addEventListener("click",async()=>{const e=window.globalConfig,t=document.getElementById("selectTheme");if(!e||!t)return;const n=O(t.value);if(!n)return;const{name:o,url:i}=n;if(U(e,o,i)){console.log("Theme already saved."),t.value="";return}await ee(e,o,i,t)});A==null||A.addEventListener("click",async()=>{const e=window.globalConfig,t=document.getElementById("selectTheme");if(!e||!t)return;const n=O(t.value);if(!n)return;const{name:o,url:i}=n;if(!U(e,o,i)){console.log("Theme not found."),t.value="";return}await te(e,o,t)});function ne(){for(const[e,[t,n,o]]of Object.entries(T)){const i=document.getElementById(n),s=document.getElementById(o);!i||!s||i.addEventListener("click",async()=>{let c;if(e==="fsProfile"?c=await window.go.main.App.SelectFolder():c=await window.go.main.App.SelectFile(),!c)return;const m=window.globalConfig;if(!!m){if(t)s.value=c,m.firefoxs[t]=c,await window.go.main.App.WriteToConfig(`firefoxs.${t}`,c);else if(e==="fsProfile"){const u=c.split(/[/\\]/).pop();s.value=u,m.firefox_profiles[u]=c,await window.go.main.App.WriteToConfig(`firefox_profiles.${u}`,c),m.selected_profile=u,await window.go.main.App.WriteToConfig("selected_profile",u),console.log(`Profile added: ${u} -> ${c}`)}console.log(`Updated config for ${e}:`,c)}})}}const I=document.getElementById("openConf"),B=document.getElementById("resetConf"),k=document.getElementById("deleteConf"),L=document.getElementById("openProfiles");I==null||I.addEventListener("click",async()=>{try{await window.go.main.App.OpenConfig()}catch(e){console.error("Error opening config:",e)}});B==null||B.addEventListener("click",async()=>{try{await window.go.main.App.ResetConfig(),h(".nav-git"),r.value="",console.log("Config deleted. Re-initializing..."),await H()}catch(e){console.error("Error resetting config:",e)}});k==null||k.addEventListener("click",async()=>{try{await window.go.main.App.DeleteConfig()}catch(e){console.error("Error deleting config:",e)}});L==null||L.addEventListener("click",async()=>{try{await window.go.main.App.OpenProfiles()}catch(e){console.error("Error opening profile path",e)}});function oe(){!R||R.addEventListener("click",async()=>{const e=window.globalConfig;if(!e)return;for(const[n,[o,i,s]]of Object.entries(T)){const c=document.getElementById(s);!c||o&&(e.firefoxs[o]=c.value,await window.go.main.App.WriteToConfig(`firefoxs.${o}`,c.value))}const t=document.getElementById("selectTheme");if(t){const n=O(t.value);if(n){const{name:o,url:i}=n;!e.saved_themes[o]&&!Object.values(e.saved_themes).includes(i)?(e.saved_themes[o]=i,await window.go.main.App.WriteToConfig(`saved_themes.${o}`,i),console.log(`Theme added via Save & Exit: ${o} => ${i}`)):console.log(`Theme already in saved_themes: ${o}`)}t.value="",t.dataset.theme=""}await g(),h(".nav-setup"),console.log("Configuration updated."),console.debug("CONFIG SAVED",e)})}const _=document.querySelectorAll(".nav-settings");_==null||_.forEach(e=>{e.addEventListener("click",async()=>{D||(await Y(),ne(),oe(),D=!0)})});const S=document.getElementById("submitgitBtn"),ie=document.getElementById("status");async function ce(){h(".nav-git"),r.value="",a("Validating configuration...");const e=await window.go.main.App.ValidateConfig();e||l("Configuration invalid.."),x=e,a("Validated."),ie.value="";try{await window.go.main.App.ProcessGit()}catch(t){l("Error processing theme: "+t.message),V("Error processing theme: "+t.message)}return e}S==null||S.addEventListener("click",async()=>{await ce()});document.getElementById("link-gituserChrome").onclick=()=>{window.go.main.App.BrowserOpenURL("https://github.com/soulhotel/git-userChrome")};document.getElementById("link-css-store").onclick=()=>{window.go.main.App.BrowserOpenURL("https://firefoxcss-store.github.io/")};document.getElementById("link-css-subreddit").onclick=()=>{window.go.main.App.BrowserOpenURL("https://www.reddit.com/r/firefoxcss")};document.getElementById("link-support").onclick=()=>{window.go.main.App.BrowserOpenURL("https://github.com/sponsors/soulhotel")};document.getElementById("link-git").onclick=()=>{window.go.main.App.BrowserOpenURL("https://github.com/soulhotel/git-userChrome?tab=readme-ov-file#need-git-click-here")};
